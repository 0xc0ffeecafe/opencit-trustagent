<!DOCTYPE html>
<html lang="en">
    <!--
    HTML5 documentation:
    http://www.w3.org/html/wg/drafts/html/master/
    http://www.w3.org/TR/2010/WD-html5-20100624/
    http://dev.w3.org/html5/html-author/
    
    Documentation on properties of HTA:APPLICATION: 
    http://www.htmlgoodies.com/beyond/reference/article.php/3472841/HTML-Applications.htm
    http://msdn.microsoft.com/library/default.asp?url=/workshop/author/hta/overview/htaoverview.asp
    
    It's possible to pack all the resources into a single executable with a custom icon using WinRAR:
    http://stackoverflow.com/questions/4592410/is-it-possible-to-add-custom-icon-to-hta
    http://www.rarlab.com/shop2rarlab-index.php?prod=winrar&x-source=winraronly
    
    <h1>Credits</h1>
    <p>Javascript libraries <a href="http://prototypejs.org/" target="_blank">prototype.js</a> (<a href="http://prototypejs.org/license.html" target="_blank">MIT License</a>), <a href="http://script.aculo.us/" target="_blank">scriptaculous.js</a> (<a href="http://madrobby.github.io/scriptaculous/license/" target="_blank">MIT License</a>), <a href="http://livepipe.net/" target="_blank">livepipe.js</a> (<a href="http://livepipe.net/#MIT" target="_blank">MIT License</a>), and <a href="https://github.com/atetlaw/Really-Easy-Field-Validation" target="_blank">validation</a> (<a href="http://opensource.org/licenses/MIT" target="_blank">MIT License</a>).</p>
    http://ajaxload.info/  for the ajax loading icon. license: "generated gifs are totally free for use"
    
    -->
    <head>
        <title>Asset Tag Reference Implementation</title>
        <meta name="Description" content="A web-based tool for defining tags and provisioning asset certificates" />
        <meta name="Keywords" content="Mt Wilson, attestation, asset, inventory, management, security, cloud, data center" />
        <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />

        <!--
    <HTA:APPLICATION ID="oMyApp" 
        APPLICATIONNAME="Mystery Hill Demo" 
        BORDER="yes"
        BORDERSTYLE="normal"
        innerBorder="yes"
        navigable="yes"
        CAPTION="yes"
        SHOWINTASKBAR="yes"
        SINGLEINSTANCE="yes"
        maximizeButton="yes"
        minimizeButton="yes"
        SYSMENU="yes"
        SCROLL="auto"
        scrollFlat="no"
        ICON="intel-logo-blue-transparent-160x121.ico"
        WINDOWSTATE="maximize"/>
        -->
        
        <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
        <!--
        <link rel="stylesheet" href="images/MarketPlace.css" type="text/css" />
        <link rel="stylesheet" href="morestyle.css" type="text/css" />
        -->
        <link rel="stylesheet" href="images/at.css" type="text/css" />

        <!--		<script src="ie-settimeout.js" type="text/javascript"><script> -->
        <script src="watch.js" type="text/javascript"></script> <!-- required to use rivets -->
        <script src="prototype-1.7.1.js" type="text/javascript"></script> <!-- required by log.js -->
        <!-- ui tools -->
        <script src="scriptaculous-1.9.0/scriptaculous.js" type="text/javascript"></script> 
        <script src="livepipe/livepipe.js" type="text/javascript"></script>
        <script src="livepipe/contextmenu.js" type="text/javascript"></script>
        <script src="livepipe/cookie.js" type="text/javascript"></script>
        <script src="livepipe/event_behavior.js" type="text/javascript"></script>
        <script src="livepipe/hotkey.js" type="text/javascript"></script>
        <script src="livepipe/progressbar.js" type="text/javascript"></script>
        <script src="livepipe/rating.js" type="text/javascript"></script>
        <script src="livepipe/resizable.js" type="text/javascript"></script>
        <script src="livepipe/scrollbar.js" type="text/javascript"></script>
        <script src="livepipe/selection.js" type="text/javascript"></script>
        <script src="livepipe/selectmultiple.js" type="text/javascript"></script>
        <script src="livepipe/tabs.js" type="text/javascript"></script>
        <script src="livepipe/textarea.js" type="text/javascript"></script>
        <script src="livepipe/window.js" type="text/javascript"></script>
        <script src="URI.js" type="text/javascript"></script>
        <script src="validation.js" type="text/javascript"></script>
        <script src="input.js" type="text/javascript"></script>
        <script src="array.js" type="text/javascript"></script>
        <script src="merge.js" type="text/javascript"></script>
        <script src="date.js" type="text/javascript"></script> <!-- required by log.js -->
        <script src="log.js" type="text/javascript"></script> <!-- requires prototype.js, date.js -->
        <script src="form.js" type="text/javascript"></script>
        <script src="rivets.js" type="text/javascript"></script>
        <script src="findx.js" type="text/javascript"></script>
        <script src="rivets-adapter-watch-findx.js" type="text/javascript"></script> <!-- requires rivets, watch.js, and findx -->
        <!-- mdv -->
        <!-- this one uses template tags, but cannot get it to work in 5 minutes so switching to rivets
        <script src="Template-instantiation-stable/mdv.js" type="text/javascript"></script> -->

        <script src="ajax.js" type="text/javascript"></script>
        <script src="atclient.js" type="text/javascript"></script>

        <!-- sample data for testing -->
        <!-- script src="sampledata.js" type="text/javascript"></script -->


        <script type="text/javascript">
            var ws = mtwilson.atag; // local name for the asset tag web service
        </script>

        <script type="text/javascript">
            // watch adapter, from https://github.com/mikeric/rivets/wiki/Adapters
            rivets.configure({
                adapter: rivets_watch_findx_adapter,
                prefix: 'bind' // so data binding happens for data-bind-whatever attributes (instead of data-whatever) ; which allows us to use input.js because it uses data-alt.
                /*
                binders: {
                    'alt': function(el,value) { } // do nothing; this allows input.js to continue using data-alt for its default display text. another way to do it would be to use the 'prefix' configuration of rivets like  prefix:'bind' and then use data-bind-whatever instead of just data-whatever in the forms.
                }
                 */
            });
        </script>

    </head>
    <body>
        <!-- wrap starts here -->
        <div id="wrap">

            <!--header -->
            <div id="header">			

                <div id="header-links">
                    <p>
                        <a href="http://www.intel.com" target="_blank">Intel</a> | 
                        <a href="http://http://cloudsecurityportal.intel.com/" target="_blank">Mt Wilson</a>
                    </p>		
                </div>		

                <div id="header-caption">
                    <h1>Asset Tag Reference Implementation</h1>
                </div>

                <!--header ends-->					
            </div>

            <!-- navigation starts-->	
            <div id="nav">
                <ul id="navtabs"> <!-- put  id="current"  on the li tag that is currently displayed -->
                    <li class="tab"><a href="#tags">Tags</a></li>  <!-- red color:  style="color: #c55" -->
                    <li class="tab"><a href="#rdf">RDF</a></li>			
                    <li class="tab"><a href="#requests">Selection</a></li>
                    <li class="tab"><a href="#certificates">Certificates</a></li>			
                    <li class="tab"><a href="#configure">Configure</a></li>
                    <li class="tab"><a href="#log">Log</a></li>
                </ul>
                <!-- navigation ends-->	
            </div>					
            <div id="ajaxstatus" style="clear: both; width: 840px; height: 20px; max-height: 50px;  margin-top: 0px; padding: 4px;">
            </div>

            <!-- content-wrap starts -->
            <div id="content-wrap" class="one-col"  >	

                <div id="main">

                    <div id="tags">
                        <h1>Tag Management</h1>


                        <h2>Create New Tag</h2>
                        <script>
                            function tag_create_form_addValue() {
                                var value = (""+$F('tag-create-values')).strip();
                                if( value.empty() ) { return; }
                                //        alert("add value: "+value);
                                mtwilson.rivets.forms['tag-create-form'].values.push($F('tag-create-values')); 
                                $('tag-create-values').focus(); 
                                $('tag-create-values').clear();        
                            }
                            function tag_create_form_removeValue(tagValue) {
                                mtwilson.rivets.forms['tag-create-form'].values.removeAll(tagValue); 
                                mtwilson.rivets.views['tag-create-form'].sync(); // XXX TODO the watch.js is supposed to detect the change in the array and the rivets-adapter-watach-findx would then call sync... but it doesn' thappen so we have to call sync() ourselves
                            }
                            // called when submitting the form... checks that at least one value was added
                            function tag_create_form_validateValues() {
                                return mtwilson.rivets.forms['tag-create-form'].values.length > 0;
                            }
                        </script>
                        <form id="tag-create-form">
                            <ul>
                                <li><label for="tag-create-name">Tag name</label><input type="text" id="tag-create-name" data-bind-value="name" name="name" placeholder="Tag name" class="required"/></li>
                                <li><label for="tag-create-oid">Tag OID</label><input type="text" id="tag-create-oid" data-bind-value="oid" name="oid" placeholder="Tag OID" class="required"/></li>
                                <!-- <li><label for="tag-create-description">Tag description</label><input type="text" id="tag-create-description" name="description"/></li> -->
                                <li><label for="tag-create-values">Tag values</label>
                                    <input type="text"  id="tag-create-values" placeholder="Value" class="validate-data" data-validator="tag_create_form_validateValues"/>
                                    <input type="button" value="Add" onclick="tag_create_form_addValue();"/>
                                    <span style="display: none;" class="validation-advice" id="advice-tag-create-values">You must add at least one value.</span>
                                    <ul style="max-width: 600px; margin-left: 0px; padding-left: 0px; list-style: none;">
                                        <li style="display: inline-block; border: 1px solid black; border-radius: 3px; padding-left: 5px; padding-right: 5px; margin: 3px;" data-bind-each-item="values"><span data-bind-text="item"></span> <a data-bind-tagValue="item" href="#" style="color: red; font-weight: bold;" onclick="javascript:tag_create_form_removeValue(this.getAttribute('tagValue'));">X</a></li>
                                    </ul>
                                </li>
                                <li><input type="button" value="Save" onclick="ws.createTag(this); return false;"/></li>
                            </ul>
                        </form>


                        <h2>Search Tags</h2>

                        <form id="tag-search-form" action="#" onsubmit="return false;">
                            <ul>
                                <li>
                                    <label for="tag-search-name">Tag name</label>
                                    <select id="tag-search-name-criteria">
                                        <option value="EqualTo">is</option>
                                        <option value="Contains">contains</option>
                                    </select>
                                    <input type="text" id="tag-search-name" name="name" placeholder="Tag name"/>
                                </li>
                                <li>
                                    <label for="tag-search-oid">Tag OID</label>
                                    <select id="tag-search-oid-criteria">
                                        <option value="EqualTo">is</option>
                                        <option value="StartsWith">starts with</option>
                                    </select>
                                    <input type="text" id="tag-search-oid" name="oid" placeholder="Tag OID"/>
                                </li>
                                <li>
                                    <label for="tag-search-value">Tag value</label>
                                    <select id="tag-search-value-criteria">
                                        <option value="EqualTo">is</option>
                                        <option value="Contains">contains</option>
                                    </select>
                                    <input type="text" id="tag-search-value" name="value" placeholder="Tag value"/>
                                </li>
                                <!--
                                <li>
                                    <label for="tag-search-description">Tag description</label>
                                    <select id="tag-search-description-criteria">
                                        <option>contains</option>
                                        <option>is</option>
                                    </select>
                                    <input type="text" id="tag-create-description" name="oid"/>
                                </li>
                                -->
                                <li><input type="button" value="Search..." onclick="ws.searchTags(this);"/></li>
                            </ul>
                        </form>

                        <h2>Browse Tags</h2>

                        <table id="tag-browse-table">
                            <caption>Tags</caption>
                            <thead>
                                <tr>
                                    <th>Tag name</th>
                                    <th>Tag OID</th>
                                    <!-- <th>Description</th> -->
                                    <th>Tag values</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tfoot>
                                <tr>
                                    <td colspan="4">
                                        <a href="#">&lt; prev</a> | <a href="#">next 10 &gt;</a>
                                        view&nbsp;<a href="#">5</a>&nbsp;<a href="#">10</a>&nbsp;<a href="#">25</a>&nbsp;<a href="#">50</a>&nbsp;<a href="#">100</a>&nbsp;per page
                                    </td></tr>
                            </tfoot>
                            <tbody>
                                <tr data-bind-each-item="tags">
                                    <td data-bind-text="item.name"></td>
                                    <td data-bind-text="item.oid"></td>
                                    <td style="max-width: 400px;">
                                        <ul style="margin-left: 0px; padding-left: 0px; list-style: none;">
                                            <li style="display: inline-block; list-style-type: inline; border: none; padding: 1px; margin: 3px;" data-bind-each-item="item.values"><span style="text-decoration: underline;" data-bind-text="item"></span></li>
                                        </ul>
                                    </td>
                                    <td><a data-bind-oid="item.oid" data-bind-uuid="item.uuid"  href="#" onclick="javascript:ws.removeTag(this.getAttribute('uuid'));">delete</a></td>
                                </tr>
                            </tbody>
                        </table>


                        <!-- end tags tab  -->
                    </div>

                    <div id="requests">
                        <h1>Tag Selection</h1>


                        <h2>Create New Certificate Request</h2>

                        <form id="certificate-request-create-form" action="#" onsubmit="ws.createCertificateRequest(/*this*/); return false;">
                            <ul>
                                <li><label for="certificate-request-create-subject">Subject</label><input type="text" id="certificate-request-create-subject" name="subject" placeholder="Host UUID"/></li>
                                <li><label for="certificate-request-create-tags-select">Tags</label>
                                    <select id="certificate-request-create-tags-select" onchange="updateviews(withValuesOfSelectedTag);">
                                        <option data-bind-each-item="tags" data-bind-text="item.name" data-bind-value="item.oid"></option>
                                    </select>
                                    <select id="certificate-request-create-tags-values">
                                        <option data-bind-each-item="tagValues" data-bind-text="item"></option>
                                    </select>
                                    <input type="button" value="Add" id="certificate-request-create-tags-select-add" onclick="log.debug('selected tag: '+$F('certificate-request-create-tags-select'))"/>
                                    <table id="certificate-request-create-tags-table">
                                        <caption>Selected Tags</caption>
                                        <thead>
                                            <tr>
                                                <th>Tag name</th>
                                                <th>Tag OID</th>
                                                <th>Tag Value</th>
                                                <!-- <th>Description</th> -->
                                                <th></th>
                                            </tr>
                                        </thead>
                                        <tfoot>
                                            <tr>
                                                <td colspan="4">
                                                    <a href="#">&lt; prev</a> | <a href="#">next 10 &gt;</a>
                                                    view&nbsp;<a href="#">5</a>&nbsp;<a href="#">10</a>&nbsp;<a href="#">25</a>&nbsp;<a href="#">50</a>&nbsp;<a href="#">100</a>&nbsp;per page
                                                </td></tr>
                                        </tfoot>
                                        <tbody>
                                            <tr data-bind-each-item="tags">
                                                <td data-bind-text="item.name"></td>
                                                <td data-bind-text="item.oid"></td>
                                                <td data-bind-text="item.value"></td>
                                                <td><a data-bind-oid="item.oid" href="#" onclick="javascript:ws.removeTagFromCertificateRequest(this.getAttribute('oid'));">remove</a></td>
                                            </tr>
                                        </tbody>
                                    </table>

                                </li>
                                <!-- <li><label for="tag-create-description">Tag description</label><input type="text" id="tag-create-description" name="description"/></li> -->
                                <li><input type="submit" value="Save"/></li>
                            </ul>
                        </form>

                        <h2>Search Certificate Requests</h2>

                        <form id="certificate-request-search-form" action="#" onsubmit="return false;">
                            <ul>
                                <li>
                                    <label for="certificate-request-search-subject">Subject (host uuid)</label>
                                    <select id="certificate-request-search-subject-criteria">
                                        <option value="equalTo">is</option>
                                    </select>
                                    <input type="text" id="certificate-request-search-subject" name="subject" placeholder="Subject"/>
                                </li>
                                <li>
                                    <label for="certificate-request-search-tagName">Tag name</label>
                                    <select id="certificate-request-search-tagName-criteria">
                                        <option value="equalTo">is</option>
                                        <option>contains</option>
                                    </select>
                                    <input type="text" id="certificate-request-search-tagName" name="tagName" placeholder="Tag name"/>
                                </li>
                                <li>
                                    <label for="certificate-request-search-tagOid">Tag OID</label>
                                    <select id="certificate-request-search-tagOid-criteria">
                                        <option value="equalTo">is</option>
                                        <option value="startsWith">starts with</option>
                                    </select>
                                    <input type="text" id="certificate-request-search-tagOid" name="tagOid" placeholder="Tag OID"/>
                                </li>
                                <li>
                                    <label for="certificate-request-search-tagValue">Tag value</label>
                                    <select id="certificate-request-search-tagValue-criteria">
                                        <option value="equalTo">is</option>
                                        <option>contains</option>
                                    </select>
                                    <input type="text" id="certificate-request-search-tagValue" name="tagValue" placeholder="Tag value"/>
                                </li>
                                <!--
                                <li>
                                    <label for="tag-search-description">Tag description</label>
                                    <select id="tag-search-description-criteria">
                                        <option>contains</option>
                                        <option>is</option>
                                    </select>
                                    <input type="text" id="tag-create-description" name="oid"/>
                                </li>
                                -->
                                <li><input type="button" value="Search..." onclick="searchCertificateRequests();"/></li>
                            </ul>
                        </form>

                        <h2>Browse Certificate Requests</h2>

                        <table id="certificate-request-browse-table">
                            <caption>Certificate Requests</caption>
                            <thead>
                                <tr>
                                    <th>Subject (host uuid)</th>
                                    <th>Tag name</th>
                                    <th>Tag OID</th>
                                    <!-- <th>Description</th> -->
                                    <th>Tag values</th>
                                </tr>
                            </thead>
                            <tfoot>
                                <tr>
                                    <td colspan="4">
                                        <a href="#">&lt; prev</a> | <a href="#">next 10 &gt;</a>
                                        view&nbsp;<a href="#">5</a>&nbsp;<a href="#">10</a>&nbsp;<a href="#">25</a>&nbsp;<a href="#">50</a>&nbsp;<a href="#">100</a>&nbsp;per page
                                    </td></tr>
                            </tfoot>
                            <tbody>
                                <tr data-bind-each-item="certificateRequests">
                                    <td data-bind-text="item.subject"></td>
                                    <td data-bind-text="item.name"></td>
                                    <td data-bind-text="item.oid"></td>
                                    <td><a data-bind-oid="item.oid" href="#" onclick="javascript:removeCertificateRequest(this.getAttribute('uuid'));">delete</a></td>
                                </tr>
                            </tbody>
                        </table>

                        <!-- end requests tab -->
                    </div>

                    <div id="certificates">

                        <h1>Manage Certificates</h1>

                        <table id="certificate-browse-table">
                            <thead>
                                <tr>
                                    <th>Host ID</th>
                                    <th>Certificate</th>
                                    <th>Fingerprint (SHA-256)</th>
                                    <th>PCR Event</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tfoot>
                                <tr>
                                    <td colspan="5">
                                        <a href="#">&lt; prev</a> | <a href="#">next 10 &gt;</a>
                                        view&nbsp;<a href="#">5</a>&nbsp;<a href="#">10</a>&nbsp;<a href="#">25</a>&nbsp;<a href="#">50</a>&nbsp;<a href="#">100</a>&nbsp;per page
                                    </td></tr>
                            </tfoot>
                            <tbody>
                                <tr data-bind-each-item="certificates">
                                    <td data-bind-text="item.subject"></td>
                                    <td data-bind-text="item.certificate"></td>
                                    <td data-bind-text="item.sha256"></td>
                                    <td data-bind-text="item.pcrEvent"></td>
                                    <td><a data-bind-uuid="item.uuid" href="#" onclick="javascript:removeCertificate(this.getAttribute('uuid'));">revoke</a></td>
                                </tr>
                            </tbody>
                        </table>

                    </div>

                    <div id="rdf">
                        <h1>Tag Policy Management</h1>


                        <h2>Create New RDF Triple</h2>

                        <form id="rdf-triple-create-form">
                            <ul>
                                <li><label for="rdf-triple-create-subject">Subject</label><input type="text" id="rdf-triple-create-subject" data-bind-value="subject" name="subject" placeholder="ID"/></li>
                                <li><label for="rdf-triple-create-predicate">Predicate</label><input type="text" id="rdf-triple-create-predicate" data-bind-value="predicate" name="predicate" placeholder="Attribute name"/></li>
                                <li><label for="rdf-triple-create-object">Object</label><input type="text" id="rdf-triple-create-object" data-bind-value="object" name="object" placeholder="Attribute value"/></li>
                                <li><input type="button" value="Save" onclick="ws.createRdfTriple(this); return false;"/></li>
                            </ul>
                        </form>

                        <h2>Search RDF Triples</h2>

                        <form id="rdf-triple-search-form" action="#" onsubmit="return false;">
                            <ul>
                                <li>
                                    <label for="rdf-triple-search-subject">Subject (id)</label>
                                    <select id="rdf-triple-search-subject-criteria">
                                        <option value="equalTo">is</option>
                                        <option>contains</option>
                                    </select>
                                    <input type="text" id="rdf-triple-search-subject" name="subject" placeholder="ID"/>
                                </li>
                                <li>
                                    <label for="rdf-triple-search-predicate">Predicate</label>
                                    <select id="rdf-triple-search-predicate-criteria">
                                        <option value="equalTo">is</option>
                                        <option>contains</option>
                                    </select>
                                    <input type="text" id="rdf-triple-search-predicate" name="predicate" placeholder="Attribute name"/>
                                </li>
                                <li>
                                    <label for="rdf-triple-search-object">Object</label>
                                    <select id="rdf-triple-search-object-criteria">
                                        <option value="equalTo">is</option>
                                        <option>contains</option>
                                    </select>
                                    <input type="text" id="rdf-triple-search-object" name="object" placeholder="Attribute value"/>
                                </li>
                                <!--
                                <li>
                                    <label for="rdf-triple-search-description">Rdf Triple description</label>
                                    <select id="rdf-triple-search-description-criteria">
                                        <option>contains</option>
                                        <option>is</option>
                                    </select>
                                    <input type="text" id="rdf-triple-create-description" name="predicate"/>
                                </li>
                                -->
                                <li><input type="button" value="Search..." onclick="searchRdfTriples();"/></li>
                            </ul>
                        </form>

                        <h2>Browse RDF Triples</h2>

                        <table id="rdf-triple-browse-table">
                            <caption>RDF Triples</caption>
                            <thead>
                                <tr>
                                    <th>Subject (id)</th>
                                    <th>Predicate (attribute name)</th>
                                    <th>Object (attribute value)</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tfoot>
                                <tr> <td colspan="4">
                                        <a href="#">&lt; prev</a> | <a href="#">next 10 &gt;</a>
                                        view&nbsp;<a href="#">5</a>&nbsp;<a href="#">10</a>&nbsp;<a href="#">25</a>&nbsp;<a href="#">50</a>&nbsp;<a href="#">100</a>&nbsp;per page
                                    </td></tr>
                            </tfoot>
                            <tbody>
                                <tr data-bind-each-item="rdfTriples">
                                    <td data-bind-text="item.subject"></td>
                                    <td data-bind-text="item.predicate"></td>
                                    <td data-bind-text="item.object"></td>
                                    <td><a data-bind-uuid="item.uuid" href="#" onclick="javascript:removeRdfTriple(this.getAttribute('uuid'));">delete</a></td>
                                </tr>
                            </tbody>
                        </table>
                        <!-- end rdf tab -->
                    </div>


                    <div id="configure">
                        <form id="config-form" onsubmit="return false;">
                            <input type="button" id="config-save-button" value="Save" onclick="saveConfig();"/>
                            <input type="button" id="config-load-button" value="Load" onclick="loadConfig();"/>

                            <fieldset><legend>Client Configuration</legend>

                                <br/>
                                <!--
                                <h2>Local Data</h2>
                                <ul>
                                <li><label for="mhclient-config-json">MHCLIENT_CONFIG</label> <input type="text" size="80" id="mhclient-config-json" value="C:\Users\jbuhacof\.mystery-hill\client\client-html5-config.json"/></li>
                                <li><label for="mhclient-home-dir">MHCLIENT_HOME</label> <input type="text" size="80" id="mhclient-home-dir" value="C:\Users\jbuhacof\workspace\mystery-hill\client\target"/> location of mhclient.jar</li>
                                <li><label for="mhclient-image-dir">MHCLIENT_IMAGES</label> <input type="text" size="80" id="mhclient-image-dir" value="C:\Users\jbuhacof\Downloads\VM Images"/></li>
                                <li><label for="mhclient-encrypted-image-dir">MHCLIENT_ENC_IMAGES</label> <input type="text" size="80" id="mhclient-encrypted-image-dir" value="C:\Users\jbuhacof\Downloads\VM Encrypted Images"/></li>
                                </ul>
                                -->
                                <h2>Web Services</h2>
                                <ul>
                                    <li><label for="provsvc">MTWILSON_ATAG_PROVSVC_URL</label> <input type="text" size="80" id="provsvc" value="https://localhost:8080" placeholder="URL"/></li>
                                </ul>
                            </fieldset>
                            <fieldset><legend>Server Configuration</legend>
                                <br/>
                                <!--
                                <h2>Local Data</h2>
                                <ul>
                                <li><label for="mhclient-config-json">MHCLIENT_CONFIG</label> <input type="text" size="80" id="mhclient-config-json" value="C:\Users\jbuhacof\.mystery-hill\client\client-html5-config.json"/></li>
                                <li><label for="mhclient-home-dir">MHCLIENT_HOME</label> <input type="text" size="80" id="mhclient-home-dir" value="C:\Users\jbuhacof\workspace\mystery-hill\client\target"/> location of mhclient.jar</li>
                                <li><label for="mhclient-image-dir">MHCLIENT_IMAGES</label> <input type="text" size="80" id="mhclient-image-dir" value="C:\Users\jbuhacof\Downloads\VM Images"/></li>
                                <li><label for="mhclient-encrypted-image-dir">MHCLIENT_ENC_IMAGES</label> <input type="text" size="80" id="mhclient-encrypted-image-dir" value="C:\Users\jbuhacof\Downloads\VM Encrypted Images"/></li>
                                </ul>
                                -->
                                <h2>Provisioning</h2>
                                <ul>
                                    <li><label for="approval-method">Approval Method</label> 
                                        <select id="approval-method">
                                            <option>Automatic/internal</option>
                                            <option>Manual/external</option>
                                        </select>
                                    </li>
                                </ul>
                            </fieldset>

                        </form>


                        <form id="ca-update-form">
                            <fieldset>
                                <legend>Certificate Authority</legend>
                                <p>A certificate authority is automatically created during a new install. 
                                    You can update the authority information here. Updating the authority information
                                    will cause the existing certificate authority to be revoked and a new one to be
                                    created with the updated information.</p>
                                <ul> 
                                    <li><label for="ca-cn">Common Name</label><input type="text" id="ca-cn" size="30" data-bind-value="cn" placeholder="First Name &amp; Last Name" class="required"/></li>
                                    <li><label for="ca-ou">Organizational Unit</label><input type="text" id="ca-ou" size="30" data-bind-value="ou" placeholder="Department" value="Cloud Security" class="required"/></li>
                                    <li><label for="ca-o">Organization</label><input type="text" id="ca-o" size="30" data-bind-value="o" placeholder="Organization or Company" value="Intel" class="required"/></li>
                                    <li><label for="ca-l">Locality</label><input type="text" id="ca-l" size="30" data-bind-value="l" placeholder="City" value="Folsom" class="required"/></li>
                                    <li><label for="ca-st">State</label><input type="text" id="ca-st" size="30" data-bind-value="st" placeholder="State or Province" value="CA" class="required"/></li>
                                    <li><label for="ca-c">Country</label><input type="text" id="ca-c" size="30" data-bind-value="c" placeholder="Country" value="US" class="required"/></li>
                                    <li><input type="button" value="Update" onclick="ws.updateCertificateAuthority(this);"/></li>
                                </ul>
                            </fieldset>
                        </form>

                        <!-- end configure tab -->
                    </div>
                </div>

                <div id="log">
                    <h1>Application Log</h1>
                    <!-- end log tab -->
                </div>
                <!-- content-wrap ends-->	
            </div>

                    <div id="logwindow" style="height: 250px; max-height: 250px; overflow: scroll; border: 2px solid #555555; margin-top: 15px; padding: 4px;">
                    </div>
            
            <!-- footer starts -->			
            <div id="footer-wrap"><div id="footer">				

                    <p>
                        &copy; 2013 Intel Corporation
                    </p>

                </div></div>
            <!-- footer ends-->	

            <!-- wrap ends here -->
        </div>

        <!-- configure javascript logging -->								
        <script>
            log.attach("logwindow");
        </script>

        <!-- script must be at the end of the markup so it can reference any element -->
        <script>
            // this section initializes the user interface   
            var navTabs = new Control.Tabs('navtabs', {
                activeClassName: 'current',
                setClassOnContainer: true,
                afterChange: function(new_container) {
                    if(new_container.id == 'tags') {
                        //                        onUpdateVoterIssues();
                    }
                    if(new_container.id == 'certificates') {
                        //                        onDisplayTally();
                    }
                }
            });
            navTabs.setActiveTab('tags');
//            navTabs.setActiveTab('rdf'); // XXX for debugging only; normally start with 'tags''
            //$('ajaxstatus').hide();
        </script>


        <script>
            //log.debug("adapter: "+rivets_watch_findx_adapter);
            //rivets-test
            //var taglist = [ {name:"tag1",oid:"1.1"}, {name:"tag2",oid:"2.2" } ];
            //var taglist = [ "hello", "world" ];
            //var taglist = [ [{name:"hello"}, {name:"world"}] ];
            //var myview = rivets.bind(document.getElementById('rivets-test'), { tags: [ {item:"hello"},{item:"world"}] }); // instead of sampledata.tags
            // *** these were enabled ***
            var tagview, rdfview, tagviewCertificateRequests, certificateView;
            //
            //taglist.push("test");
            //myview.build();
            //mybindings.update({filter: mytags});
            //sampledata.tags.push({"name":"new tag","oid":"1.2.3.4","values":["hello","world"]});
            ws.initialize({
                options: {
                    baseurl: 'http://localhost:8080'
                },
                //views: { 'tags': tagview, 'rdf-triples': rdfview }
//                data: sampledata, // optional: if not provided will start empty and then we can load it from server
                view: { 'update': function(data) {
                        tagview.update(data);
                        rdfview.update(data);
                        tagviewCertificateRequests.update(data);
                        certificateView.update(data);
                    },
                    'sync': function() {
                        log.debug("syncing tagview");
                        log.debug("data... "+Object.toJSON(ws.data));
                        tagview.sync();
                        log.debug('tagview sync done');
                        rdfview.sync();
                        tagviewCertificateRequests.sync();
                        certificateView.sync();
                    }
                }
            });
            log.debug("after init, data: "+Object.toJSON(ws.data));
            tagview = rivets.bind(document.getElementById('tag-browse-table'), ws.data); 
            rdfview = rivets.bind(document.getElementById('rdf-triple-browse-table'), ws.data); 
            tagviewCertificateRequests = rivets.bind(document.getElementById('certificate-request-create-tags-select'), ws.data); 
            certificateView = rivets.bind(document.getElementById('certificate-browse-table'), ws.data); 

//ws.updateTags(sampledata.tags); // xxx initialize with sample data
            ws.searchTags('tag-search-form');

            // removes all tags with this uuid
            function removeRdfTriple(uuid) {
                for(var i=sampledata.rdfTriples.length-1; i>=0; i--) {
                    if( ('uuid' in sampledata.rdfTriples[i]) && sampledata.rdfTriples[i].uuid == uuid ) {
                        sampledata.rdfTriples.splice(i,1);  // removes just this element...  note it's the first one found, so if you search for something that appears many times, only the first one will be removed!
                        //					return;
                    }				
                    rdfview.update(sampledata);
                }
            }
		
        </script>

    </body>
</html>
